# プロジェクト概要

## 基本情報

* **プロジェクト名**: SteamSentinel
* **リポジトリ名**: `SteamSentinel`
* **説明**: Steamゲームの価格監視、Epic Games無料ゲーム検知、高割引ゲーム自動検知、出費追跡・予算管理、ITAD設定管理を統合した包括的なゲーム財務管理システム。WebサイトとDiscord通知で情報提供。
* **由来**: Steam（Steam）+ Sentinel（見張り番）= ゲーム価格の忠実な見張り役。
* **成熟度**: 企業レベル完成度 95% - React 19 + TypeScript + Ant Design完全実装、70+ APIエンドポイント、包括的予算管理・ITAD設定システム。

## 監視対象とデータソース

### Steam価格監視
* **監視対象**: Steam App IDに基づくゲームリスト (データベース管理)。
    * 有名なゲーム50-100タイトルのプリセットリストを内蔵。
    * ゲームの動的な追加・削除機能。
* **データソース**:
    * **メイン**: IsThereAnyDeal API (地域: 日本、通貨: JPY)
    * **サブ**: Steam Store API (地域: 日本)

### Epic Games無料ゲーム監視
* **監視対象**: Epic Games Store無料配布ゲーム
* **データソース**:
    * **メイン**: epic-free-games パッケージ (Epic Games API経由)
    * **サブ**: IsThereAnyDeal API (Epic Games Store フィルタ)

### 高割引ゲーム検知システム
* **監視対象**: IsThereAnyDeal API全体の高割引ゲーム（登録ゲーム制限なし）
* **データソース**:
    * **メイン**: IsThereAnyDeal API deals エンドポイント
    * **設定管理**: itad_settings データベーステーブル（動的フィルタ設定）
* **検知条件**:
    * 最小割引率: 20%〜90% (設定可能)
    * 最大価格: ¥5000以下 (設定可能) 
    * 取得件数: 50件 (設定可能)
    * 地域: 日本 (JP)
* **統合機能**: 専用UI・ページネーション・購入記録連携・Discord通知

## アラート条件と頻度

* **アラート条件**:
    * **条件A**: IsThereAnyDealの歴代最安値を下回った時。
    * **条件B**: セール開始 (割引率 > 0%になった時)。
    * 両条件でアラートが発生します。
    * 個別ゲームごとの価格閾値設定 (`○○円以下で通知`)、割引率閾値設定、セール開始通知のON/OFFが可能。
* **監視頻度**: デフォルト1時間間隔 (設定で12時間間隔に変更可能)。

## 実行環境

* **環境**: ローカル環境 (Windows/Mac/Linux)
* **サーバー**: Node.js + Express.js
* **データベース**: SQLite (データ永続化)

## エラー処理・復旧戦略

### データベース関連エラー

* **破損検知**: 起動時の整合性チェック。
* **復旧方法**: 自動バックアップからの復元。
* **フォールバック**: 新規データベース作成 (履歴は失われます)。

### API障害時の対応

* **短期障害 (1時間未満)**: エラーログ出力、次回サイクルで再試行。
* **長期障害 (1時間以上)**: 管理画面で障害状況を表示し、手動確認を促します。
* **完全障害**: 利用可能なAPIのみで継続し、機能制限を明示します。

### 設定ファイル問題

* **破損・欠損**: デフォルト値で動作を継続します。
* **不正値**: 設定範囲内に自動補正します。
* **権限エラー**: エラーメッセージで手動修正を促します。

### プロセス異常終了

* **ログ記録**: 詳細なエラー情報をファイルに出力します。
* **状態保存**: 処理中のデータを安全に保存します。
* **手動再起動**: systemd/pm2などでの自動復旧は運用者の判断に委ねます。

## 地域対応

* **現バージョン**: 日本のみ対応 (通貨: JPY, 価格ソース: Steam Store API (cc=jp), IsThereAnyDeal API (region=jp))。
* **将来対応予定**: US (USD), EU (EUR), UK (GBP)。設定ファイルで地域選択可能にする。地域ロックされたゲームの価格は除外します。

## テスト要件

* **単体テスト**: API関数のレスポンス処理、価格比較ロジック、データベース操作。
* **統合テスト**: 全監視フローの動作確認、Web UIの基本操作、アラート機能。
* **軽量負荷テスト**: 50ゲーム同時監視、連続24時間稼働、メモリリーク検証。
* **実装方針**: Jestを使用し、過度な負荷をかけない範囲で実装します。